<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link href="/css/readreview.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    <title>Food Reviews of <%=food_name%></title>
  </head>
  <body>
    <nav class="navbar sticky-top navbar-light bg-light">
      <div class="container-fluid">
        <a
          class="navbar-brand"
          role="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasBottom"
          aria-controls="offcanvasBottom"
        >
          <img
            src="<%= food_img %>"
            alt="img of <%= food_name %>"
            width="30"
            height="24"
            style="object-fit: cover; border-radius: 10%"
            class="d-inline-block align-text-top"
          />
          <%= food_name %>
        </a>
      </div>
    </nav>
    <div
      class="offcanvas offcanvas-start"
      tabindex="-1"
      id="offcanvasBottom"
      aria-labelledby="offcanvasBottomLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasBottomLabel">
          <%= food_name %>
        </h5>
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <div class="card" style="width: auto">
          <img
            src="<%= food_img %>"
            class="card-img-top"
            alt="img of <%= food_name %>"
          />
          <div class="card-body">
            <div class="row overall-rate">
              <div
                id="rateYo"
                class="col-4"
                data-rateyo-num-stars="5"
                data-rateyo-rating="<%= overalRating %>"
                data-rateyo-read-only="true"
              ></div>
              <div class="col overall-rating-text">
                <span><%= overalRating %> out of 5</span>
              </div>
            </div>
            <div class="text-center customer-count">
              <%=reviews.length %> customer ratings
            </div>
            <div class="rating-details">
              <div class="row p-2">
                <div class="col text-center">
                  <span id="rate-lable">5 star</span>
                </div>
                <% var
                star5=(ratings[5]/(ratings[5]+ratings[4]+ratings[3]+ratings[2]+ratings[1]))*100;
                var star4=
                (ratings[4]/(ratings[5]+ratings[4]+ratings[3]+ratings[2]+ratings[1]))*100;
                var star3=
                (ratings[3]/(ratings[5]+ratings[4]+ratings[3]+ratings[2]+ratings[1]))*100;
                var star2=
                (ratings[2]/(ratings[5]+ratings[4]+ratings[3]+ratings[2]+ratings[1]))*100;
                var star1=
                (ratings[1]/(ratings[5]+ratings[4]+ratings[3]+ratings[2]+ratings[1]))*100;%>
                <div class="col-6 p-1">
                  <div class="progress">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: <%= star5 %>%"
                      aria-valuenow="<%= star5 %>"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="col text-center">
                  <span id="rate-percentage"> <%= star5 %>% </span>
                </div>
              </div>
              <div class="row p-2">
                <div class="col text-center">
                  <span id="rate-lable">4 star</span>
                </div>
                <div class="col-6 p-1">
                  <div class="progress">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: <%= star4 %>%"
                      aria-valuenow="<%= star4 %>"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="col text-center">
                  <span id="rate-percentage"> <%= star4 %>% </span>
                </div>
              </div>
              <div class="row p-2">
                <div class="col text-center">
                  <span id="rate-lable">3 star</span>
                </div>
                <div class="col-6 p-1">
                  <div class="progress">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: <%= star3 %>%"
                      aria-valuenow="<%= star3 %>"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="col text-center">
                  <span id="rate-percentage"> <%= star3 %>% </span>
                </div>
              </div>
              <div class="row p-2">
                <div class="col text-center">
                  <span id="rate-lable">2 star</span>
                </div>
                <div class="col-6 p-1">
                  <div class="progress">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: <%= star2 %>%"
                      aria-valuenow="<%= star2 %>"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="col text-center">
                  <span id="rate-percentage"> <%= star2 %>% </span>
                </div>
              </div>
              <div class="row p-2">
                <div class="col text-center">
                  <span id="rate-lable">1 star</span>
                </div>
                <div class="col-6 p-1">
                  <div class="progress">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: <%= star1 %>%"
                      aria-valuenow="<%= star1 %>"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
                <div class="col text-center">
                  <span id="rate-percentage"> <%= star1 %>% </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <main>
      <div
        class="card-containers"
        style="
          display: flex;
          justify-content: center;
          flex-direction: column;
          margin-top: 10px;
          align-items: center;
          align-content: center;
        "
      >
        <% reviews.forEach(function(value,index){%>
        <div
          class="card animinate-card"
          style="width: 80%; height: 20%; margin: 10px"
        >
          <div class="card-body">
            <div class="row">
              <div class="col-sm-auto profile-container">
                <div class="row">
                  <img
                    src="<%= value.user.profile_img %>"
                    width="100"
                    height="100"
                    class="profile-picture"
                  />
                </div>
                <div class="row text-center">
                  <span class="u-name"><%= value.user.name %></span>
                </div>
                <div class="row text-center">
                  <span class="u-type">COUSTOMER</span>
                </div>
              </div>
              <div class="col container">
                <div class="row">
                  <span class="review-title"><%= value.review.title %></span>
                </div>
                <div class="row">
                  <span class="small review-post-date"
                    >Rate <%= value.review.rate %> out of 5</span
                  >
                </div>
                <div class="row">
                  <%var posted_on=`${moment(value.date).format("DD-MM-YYYY")} at
                  ${moment(value.date).format("HH:MM a")}`; var
                  user_likes=value.like &&
                  value.like.value?value.like.value:"0"; var
                  user_dislikes=value.dislike && value.dislike.value
                  ?value.dislike.value:"0"; %>
                  <span class="review-post-date"
                    >Posted On: <%=posted_on%></span
                  >
                </div>
                <div class="row">
                  <div class="container">
                    <p class="user-review-comment">
                      <%= value.review.comment %>
                    </p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-2 user-action">
                    <span
                      id="u-like"
                      class="comment-like-<%= reviewIds[index] %>"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-original-title="<%=user_likes%>"
                      style="padding: 3px"
                      onclick="onLike('<%= reviewIds[index] %>','<%= mealid %>','<%=uid%>');"
                    >
                      <% if(reactions[reviewIds[index]] &&
                      reactions[reviewIds[index]]==="like") { %>
                      <i class="fa-solid fa-thumbs-up"></i>
                      <% } else{%>
                      <i class="fa-regular fa-thumbs-up"></i>
                      <% } %>
                    </span>
                    <small
                      class="row"
                      style="position: relative; margin-left: 0.15px"
                      >Like</small
                    >
                  </div>
                  <div class="col-2 user-action">
                    <span
                      id="u-dislike"
                      class="comment-dislike-<%= reviewIds[index] %>"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-original-title="<%=user_dislikes%>"
                      onclick="onDisLike('<%= reviewIds[index] %>','<%= mealid %>','<%=uid%>');"
                    >
                      <% if(reactions[reviewIds[index]] &&
                      reactions[reviewIds[index]]==="dislike"){ %>
                      <i class="fa-solid fa-thumbs-down"></i>
                      <% }else{ %>
                      <i class="fa-regular fa-thumbs-down"></i>
                      <% } %>
                    </span>
                    <small class="row">Dislike</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
    </main>
  </body>
  <script src="/js/readreview.js" type="module"></script>
</html>
